5月5日下午，质管、运维部门关于 Vagrant 的会议记录：

1. 本地开发环境的问题一定要解决；
2. BOSS 早有虚拟机搭建指南和镜像下载，但使用繁琐。如无强力介入，麻烦的东西，通常就没人用，就等于无用；
3. 而 Vagrant 将改变这一切。一键搭建，一键升级不是梦，结合自动化脚本等方式可进一步提高其易用性；
4. Vagrant 实现方案已很成熟，难点在于全面推广；
3. 考虑到依赖项目很多，且单元测试的需要。先推行 Mock Server 项目。以得到项目间更彻底的解藕，平行开发，减少虚拟机资源占用等多种好处；
4. 以上为与会人员林月令，胡名海，刘德建，罗涛等人的讨论结果。谢谢月令的组织。


# Mock Server

## 指标

1. 提供 Mock 接口，隔离因接口故障带来的开发问题；
2. 提供接口文档；
3. 提供单元测试。文档本身做为一种可运行的单元测试，规约接口的开发和使用方；
4. 可以用 Vagrant 分发。以实现：不论合适何地，笔记本一开就可以快速开发。连网络都不需要。

## 实现

建议基于 apib 格式(https://apiblueprint.org/) 。

我之前已经用 nodejs 开发了一套，已经实现了上面的四个指标。文档效果和写法见附图。还可以继续开发，提供更多便利。

---
附图一：apib 文档的实例

附图二：apib 文档的 web 查阅










1. 过去十年我投入了大量时间并取得一定成果的。是研究怎么用自动化脚本，工具提高程序员的效率；
2. 那些工具我都已切身使用了十年以上，在 10 人小团队推广了三年以上，成熟好用；
3. 如果能把那些工具在猪网普及开来，相比以前的小团队，一定会爆发出更多的价值；
4. 虽为运维，但愿意在开发之余，协助陶哥完成这件事。目的是为程序员服务。让程序员爽；
5. 需要陶哥的支持，不然不可能完成这个任务。请陶哥指导，我需要和那个部门，那个人合作完成；
6. 第一个想推广的，是和线上环境一致、易于部署的本机开发环境。即下面的 Vagrant 方案。
7. 后续还想做的，让程序员爽的，包括：
	- 发挥擅长多种语言优势，优化全站日志，在一个地方看到用户动作的整个内部流转，使调试，跟踪错误更容易；
	- API 版本，项目版本概念；
	- 其它。

	

# 用 Vagrant 统一开发环境

1. 全平台（Win，Linux，OSX）支持；
2. 使用 vagrant 分发虚拟机镜像，易于维护，升级；
3. 虚拟机与线上服务器一致，使用 centos，资源占用低，老笔记本电脑都不会卡；
4. 开箱即用，装机 5 分钟搭好所有开发环境。

# 统一环境

查看运维平台项目时，发现开发流程是开发者本机没有运行环境，把代码提交到 Git 仓库，然后登录内部测试服务器，从 Git 取出代码，然后运行调试。

这是一个明显的大便，散发出恶臭，看到时有真实的恶心感。

我觉得解决方案除了普及 SCM 的正确用法外，还需要让程序员可以很容易的在本机搭建运行环境。以前团队使用了一年多的方案是：使用 Vagrant。效果是：

一台全新安装的电脑（Win，Linux，OSX皆可），只需安装:

1. Vagrant
2. VirtualBox
3. 引导脚本 Makefile.

然后 make up，就拥有了一个和线上环境，测试环境完全一样的本地开发环境。
这样的好处是：

1. 大大节省了环境配置的时间；
2. 解决了因运行环境上一些细微的不一致导致的 bug。


# API 版本

运维想做回滚时，发现这个问题，如果 B1 依赖 A_Ver11, B2 依赖 A_Ver22, C 依赖 A_Ver22, 则如果需要回滚 B2 到 B1 时，C 会报错。现在的处理方式是全局回滚。如果想做到单项目回滚，可以考虑在代码里处理依赖的兼容性。对于新功能设置开关，比如：

> if ($boss_ver > 22) {
> 
>   new_feature();
> 
> }