---
deploy: yk lt
layout: post
title: "持久化排序"
date: 2013-02-27 10:22
comments: true
categories:
---
#+OPTIONS: ^:nil

* 应用场景

对变动频繁的对象排序分页时，很可能出现翻页时，比如点第 2 页后，发现部分数据已在前面，如第 1 页显示过。这就要求我们在一次翻页操作过程中，持久化排序序列。以使数据不重复。

典型应用场景如手机端的瀑布流式下拉翻页。

* 方案

1. 要持久化一次排序过程，需要对标识这次排序，并在这次排序操作中传递这
   个标识。

   示例：/?p=2 改为 /?p=2&sort_id=PP7GKyk9PkfcSZR

2. 以上一步生成的排序标识为键，以排序结果为值，存入缓存。以在这次排序
   的各分页里调用。


* 优化

1. 优化排序结果。

   在缓存里只存入排序结果对象的 id 数组，而不是各对象的详细信息。

   示例：[{id:12,detail:'xxx'},{id:56, detail:'yyy'}] 优化为 [12,56]。

2. 优化排序速度。

   复杂的排序可能速度很慢，影响页面打开速度。可以在后台计划任务，比如
   每隔 3 分钟运行一次排序脚本并存入缓存。用户打开页面时直接从缓存里读
   取结果，而达到快速排序的目的。
