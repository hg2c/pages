#+OPTIONS: ^:nil

#+BEGIN_HTML
---
deploy: yk
layout: post
title: "愉快网约吃饭系统设计"
date: 2012-12-26 16:13
comments: true
categories: yk-app-yue
---
#+END_HTML
* 架构说明


  为快速建模，这次设计以页面数据为中心。面向页面需求，通过 Value Object
  建立页面数据接口，在此基础上扩展。设计中参照如下准则：

- 组件化重用
- 对所有数据库操作，使用内存缓存
- 对 VO 中代价较高的属性，使用延迟获取技术
- 对于频繁更新的数据，可以考虑使用微缓存，即缓存时间设为5秒
- 业务处理逻辑放到 Model, 轻量化 Controller
- DDD：领域模型设计
- SRP：单一权责原则
- CQRS：读写分离

  其它规则：

- 提供 评论 服务，供聚餐活动记录，照片留言等使用；
- 提供 相册 服务，供需要图片的地方调用；
- 日期、时间在数据库统一存为 timestamp 形式：int(10)
- SQL中，所有数据库表必须用函数 DB::table(table_name) 包装，所有属性必须用函数 DB:chexk() 如：
  'select * from '. DB::table('party'). ' where pid = '. DB::prop($pid);


* 命名、缩写约定表

  | 命名      | 指代     | 备注                   |
  |-----------+----------+------------------------|
  | hot       | 人气     |                        |
  | new       | 最新     |                        |
  | add       | 添加     |                        |
  | delete    | 删除     |                        |
  | edit      | 编辑     |                        |
  | publish   | 发布     |                        |
  | cancel    | 取消     |                        |
  | recomment | 推荐     |                        |
  | season    | 期数     |                        |
  | lnop      | 限定人数 | limit number of people |
  | auth      | 认证     | authentication         |
  | join      | 参加     |                        |
  | create    | 创建     |                        |


  | 命名             | 指代                     | 备注                 |
  |------------------+--------------------------+----------------------|
  | User             | 用户                     |                      |
  | Logined          | 当前登录用户             |                      |
  | Anonymous        | 匿名、未登录用户         |                      |
  | Profile          | 档案、配置               | 基于组、用户策略生成 |
  | Group            | 用户组                   | @TODO                |
  | Appointment      | 约会                     |                      |
  | Restaurant       | 餐厅                     |                      |
  | Party            | 聚会、聚餐               |                      |
  | Party_Member     | 聚会申请者、参与者       |                      |
  | Party_Profile    | 聚会模块用户的配置、档案 |                      |
  | Party_Record     | 聚餐记录、精彩聚餐       |                      |
  | Party_Activity   | 聚餐动态                 | @TODO                |
  | Foretaste_Report | 试吃报告、聚餐报告       |                      |
  | Meals            | 套餐                     |                      |
  | Talent           | 餐花                     | 此翻译参考英国达人   |
  | Talent_Champion  | 餐花冠军                 |                      |
  | Circle           | 圈子                     |                      |
  | Circle_Topic     | 圈中话题                 | @TODO                |
  | YIM              | 在线聊天模块的开发代号   | @TODO                |
  | YIM_User         |                          | @TODO                |
  | Award            | 奖品                     |                      |
  | Realname_Auth    | 实名认证                 |                      |

实名认证前台：?q=realname/auth
餐花秀首页：?q=talent/index
餐花秀获奖名单及规则：?q=talent/champion
餐花秀获奖名单及规则：?q=talent/rule
参加餐花秀：?q=talent/join
餐花秀个人主页：?q=talent/homepage
餐花秀管理：?q=admin/talent
聚餐记录管理：?q=admin/party/record
活动发布者管理：?q=admin/party/organizer

* 原型页面标识对应表

| 页面标识 | 页面名称                    |
|----------+-----------------------------|
| 主       | 约吃饭主页                  |
| A        | A 活动审核                  |
| A1       | A-1 活动详情                |
| B        | B 活动管理                  |
| B1       | B-1 已发布活动查看活动      |
| B2       | B-2 已结束/进行中的活动查看 |
| B3       | B-3 已取消活动查看          |
| C        | C 活动发布者管理            |
| G        | G 圈子管理（V2.0）          |
| G1       | G-1 添加圈子（V2.0）        |
| H        | H 餐花秀管理（首页活动位）  |

*** 开发步骤
  
1 设计URL
  如：
  通过关键字搜索用户
  /?q=user/search&keyword=%

** 前端功能点

| URL | 功能                               | 前端 | 后端 | 外部 | 备注                                                              |
|-----+------------------------------------+------+------+------+-------------------------------------------------------------------|
|     | 单张图片上传                       | X    | X    |      | 可选：支持上传后预览图片                                          |
|     | 多张图片上传                       | X    | X    |      | 支持从服务器数据生成已上传图片列表，支持从图片列表中删除指定图片  |
|     | 分享组件                           | X    |      |      | 分享到。。分享餐厅，聚会等                                        |
|     | 倒计时支持                         | X    | X    |      | 支持时间到后调用函数                                              |
|     | 发起聚餐时间选择                   | X    |      |      | 全站日历、日期、时间选择组件：比如选择聚餐时间                    |
|     | 走马灯幻灯片区域                   | X    |      |      | <<[][][]>> 比如一次显示三张图片，点左右箭头，横向滚动未显示的图片 |
|     | + 首页广告轮播                     | X    | X    |      | 走马灯的一种，见首页广告                                          |
|     | 对话框：确定、关闭                 | X    |      |      | 全站组件：页面弹出框，带确定，关闭按钮并可指定对应回调事件        |
|     | 对话框：输入                       | X    |      |      | 页面弹出框，可输入内容                                            |
|     | 对话框：自定义按钮                 | X    |      |      | 页面弹出框，可自定义按钮文字和事件                                |
|     | 对话框：嵌入页面                   | X    |      |      | 页面弹出框，内可嵌页面                                            |
|     | 下拉面板                           | X    |      |      | 本质上也是一种对话框，用于：如赴约栏目显示约会内容详情            |
|     | 瀑布流                             | X    | X    |      | 参见 G-1-1 圈友（V2.0）                                           |
|     | 标签输入、删除                     | X    | X    |      | 可用于输入活动范围                                                |
|     | 标签选择控件                       | X    | X    |      | 列出可选标签，进行选择。用于：如发起约会里显示约会内省            |
|     | 限定文本框字数并实时统计可输入字数 | X    |      |      |                                                                   |
|     | 商家选择控件                       | X    | X    |      |                                                                   |
|     | 圈子选择控件                       | X    | X    |      |                                                                   |
|     | 套餐选择控件                       | X    | X    |      |                                                                   |
|     | 聚餐活动选择控件                   | X    | X    |      |                                                                   |
|     | 地图显示模块                       | X    |      |      | 用于：如显示餐厅位置                                              |

** 后端功能点

| URL                    | 功能                                  | 前端 | 后端 | 外部 | 备注                                  |
|------------------------+---------------------------------------+------+------+------+---------------------------------------|
|                        | 数据表 CRUD                           |      | X    |      | 实现通用的数据表维护更新              |
|                        | 数据表 分页                           |      | X    |      |                                       |
|                        | 缓存支持                              |      | X    |      |                                       |
|                        | 短信交互                              |      | X    |      | 照模板发送短息，分析上行短信          |
|                        | 相册                                  |      | X    |      | 管理所有图片                          |
|                        | 自动缩略图                            |      | X    |      | thumb(1.jpg, 320,240) > 1_320x240.jpg |
|                        | 字数截取                              |      | X    |      | lotr... VS 老孟的愉...                |
|                        | 手机号验证                            | X    | X    |      |                                       |
|                        | 实名验证                              | X    | X    |      |                                       |
|                        | User.搜索                             |      | X    |      |                                       |
|                        | User.更多                             |      | X    |      |                                       |
|                        | User.详情                             |      | X    |      |                                       |
|                        | User.获取首页人气列表                 |      |      |      | 关注数>注册时间                       |
|                        | User.获取首页最新列表                 |      |      |      | 注册时间                              |
|                        | User.获取推广运营人员列表             |      |      |      | 用于后台创建圈子                      |
|                        | User.+关注                            |      |      |      |                                       |
|                        | User.约TA                             |      |      |      | 出聊天窗口                            |
|                        | User.获取组？                         |      |      |      | 用于聚餐发起人属性等，要便于搜索      |
|                        | User.获取关注列表                     |      | X    |      |                                       |
|                        | User.获取粉丝列表                     |      | X    |      |                                       |
|                        | User.发起约会                         |      | X    |      |                                       |
|                        | User.获取正在约的人列表               |      | X    |      |                                       |
|                        | User.获取约过的人列表                 |      | X    |      |                                       |
|                        | User.获取空间访客列表                 |      | X    |      | ?                                     |
|                        | User.获取创建的约会列表               |      | X    |      | 发起的约会                            |
|                        | User.获取参加的约会列表               |      | X    |      |                                       |
|                        | Circle_User.获取创建的圈子列表        |      | X    |      |                                       |
|                        | Circle_User.获取参加的圈子列表        |      | X    |      |                                       |
|                        | Circle_User.获取最大可创建圈子数量    |      | X    |      |                                       |
|                        | Circle_User.获取剩余可创建圈子数量    |      | X    |      |                                       |
|                        | Circle_User.申请加入                  | X    | X    |      | 弹出层内嵌新页面                      |
|                        | Circle_User.退出圈子并记录原因        | X    | X    |      |                                       |
|                        |                                       |      |      |      |                                       |
| /party/creator         | Party_User::获取所有聚会发起者列表    |      | X    |      |                                       |
| /party/invite&pid=%s   | Party_User.邀请朋友参加               | X    | X    |      | 需支持短信交互，多种短信模板          |
| /my/party/created      | Party_User.获取发起的聚会列表         |      | X    |      |                                       |
| /my/party/joined       | Party_User.获取参加的聚会列表         |      | X    |      |                                       |
| /party/register&pid=%s | Party_User.报名参加聚会               |      | X    |      | 可带人                                |
|                        | Party_User.获取报名某个聚会的审批状态 |      | X    |      |                                       |
| /party/add             | Party_User.创建聚会                   |      |      |      |                                       |
|                        | Party_User.获取报名某个聚会的出席人数 |      | X    |      |                                       |
|                        | Party_User.审核聚会报名用户           | X    | X    |      | [拒绝、邀请]                          |
|                        | Party_User.创建聚会记录               |      | X    |      |                                       |
|                        | Party_User.相册                       |      |      |      | @TODO                                 |
|                        | Party_User.评论相册                   |      |      |      | 照片留言                              |



| URL                    | 功能                                 | 前端 | 后端 | 外部 | 备注                          |
|------------------------+--------------------------------------+------+------+------+-------------------------------|
|                        | Appointment.搜索                     |      | X    |      |                               |
|                        | Appointment.更多                     |      | X    |      |                               |
|                        | Appointment.详情                     |      | X    |      |                               |
|                        | Appointment.赴约                     |      |      |      | 出聊天窗口                    |
|                        | Appointment.获取首页约会列表         |      |      |      | 随机，每小时一换              |
| api/restaurant/suggest | Restaurant.输入框自动建议功能回调API |      |      | X    |                               |
|                        | Restaurant.详情                      |      |      | X    |                               |
|                        | Restaurant.立即预定                  |      |      | X    |                               |
|                        | Restaurant.获取约会人气餐厅列表      |      |      | X    | 人工>关注度                   |
|                        | Restaurant.获取精选聚餐餐厅列表      |      |      | X    | 人工>关注度                   |
|                        | Restaurant.关注                      |      |      |      | +-                            |
|                        | Restaurant.分享                      |      |      |      |                               |
|                        | Meals.详情                           |      |      | X    |                               |
|                        | Meals.立即预定                       |      |      | X    |                               |
|                        | Meals.获取约会人气套餐列表           |      |      | X    | 人工>收藏数                   |
|                        | Meals.获取聚餐人气套餐列表           |      |      | X    | 人工>收藏数                   |
|                        | Party.更多                           |      | X    |      |                               |
| party/detail&pid=%s    | Party.详情                           |      | X    |      |                               |
|                        | Party.分享                           |      | X    |      |                               |
|                        | Party.推荐与否                       |      | X    |      |                               |
|                        | Party.发布与否                       |      | X    |      |                               |
|                        | Party.取消与否                       |      | X    |      |                               |
| party/index/list       | Party.获取首页列表                   |      | X    |      | 人工>活动时间                 |
|                        | Party.获取申请者列表                 |      | X    |      |                               |
|                        | Party.获取当前可进行的操作列表       |      |      |      | 按钮形式,不同页面操作可能不同 |
|                        | Party.是否人数已满                   |      | X    |      |                               |
|                        | Party.创建聚会记录                   |      | X    |      | 即创建评论 /?q=comment        |
|                        | Party_Record.更多                    |      | X    |      |                               |
|                        | Party_Record.详情                    |      | X    |      |                               |
|                        | Party_Record.获取首页列表            |      | X    |      | 记录创建时间                  |
|                        | Foretaste_Report.详情                |      | X    |      |                               |
|                        | Foretaste_Report.获取首页列表        |      |      |      | 人工                          |

| URL            | 功能         | 前端 | 后端 | 外部 | 备注 |
|----------------+--------------+------+------+------+------|
| comment/add    | Comment.创建 |      |      |      |      |
| comment/delete | Comment.删除 |      |      |      |      |
| comment/edit   | Comment.编辑 |      |      |      |      |



| URL | 功能                               | 前端 | 后端 | 外部 | 备注                       |
|-----+------------------------------------+------+------+------+----------------------------|
|     | Talent.送花                        |      |      |      |                            |
|     | Talent.更多                        |      |      |      |                            |
|     | Talent.获取人气餐花列表            |      | X    |      | 关注度                     |
|     | Talent.获取最新餐花列表            |      | X    |      | 参加餐花秀活动的时间       |
|     | Talent_Champion.更多               |      |      |      |                            |
|     | Circle_Repository.获取全部圈子列表 |      | X    |      | 更多                       |
|     | Circle_Repository.获取首页列表     |      | X    |      | 随机，每小时一换           |
|     | Circle.创建圈子                    | X    | X    |      |                            |
|     | Circle.详情                        |      |      |      |                            |
|     | Circle.获取圈内话题列表            |      | X    |      |                            |
|     | Circle.获取圈内成员列表            |      | X    |      |                            |
|     | Circle.获取圈内聚餐列表            |      | X    |      |                            |
|     | Circle.通过、拒绝他人的加入申请    | X    | X    |      |                            |
|     | YIM.1对1聊天                       |      |      |      |                            |
|     | YIM.分组聊天                       |      |      |      | 聚餐聊天室,查看聊天记录    |
|     | YIM.表情支持                       |      |      |      |                            |
|     | 机器人.向餐花秀女孩送花            |      |      |      | 机器人指用作运营的模拟用户 |
|     | 首页CMS                            |      |      |      | @TODO                      |


| 图 | 例                 |
|----+--------------------|
| *  | 该字段取值不能为空 |
| P  | 该字段为主键       |
| F  | 该字段为外键       |
| S  | 将通过该字段搜索   |
| O  | 将通过该字段排序   |

``` php VO使用示例
// 得到用户 $circle_user 的粉丝列表
$followers = $circle_user.cu_followers;

// Party 使用示例
$party = Party_Repository::find_by_id($pid);
$party_creater = $party.party_user.user_nickname;
```

VO_User
-------------

| 属性          | 类型    | 示例        | 备注                                |
|---------------+---------+-------------+-------------------------------------|
| id            |         | keke        | 登录名，即 yukuai.site_user.userpin |
| nickname      |         | 可可        | 昵称，显示名。如未设置，则显示 id   |
| realname      |         | 曾轶可      | 真名，如未设置，则显示 nickname     |
| realname_auth | boolean | 0           | 真名是否已认证 [未验证，已验证]     |
| mobile        |         | 13220202020 | 手机号码                            |
| mobile_auth   | boolean | 0           | 手机是否已认证 [未验证，已验证]     |
  
|               | 头像            |                         |                                              |
|               | 性别            | 女                      |                                              |
|               | 生日            | 1991年6月15日           |                                              |
|               | 年龄            | 21                      | 根据生日计算                                 |
|               | 区域            | 沙坪坝                  | 实现按附近的人搜索                           |
|               | 现居地          | 重庆市江北区            |                                              |
|               | 常出没的地方    | 重庆>观音桥 解放碑 南坪 |                                              |
|               | 职业            | 产品经理                |                                              |
|               | 心情、签名？    | ^_^                     |                                              |
|               | 相册            |                         | @TODO                                        |
|               | 是否已登录      |                         |                                              |
|               | 关注列表、数量  |                         |                                              |
|               | 粉丝列表、数量  |                         |                                              |
|               | 礼物列表、数量  |                         |                                              |
|               | 访客列表、数量  |                         |                                              |
|               | 是否已实名认证  |                         |                                              |
|               | 得票            |                         | 得票=人气？                                  |
|               | 人气            |                         | 什么是人气？                                 |
|               | 最新            |                         | 什么算最新？                                 |
|               | 星座            |                         |                                              |
|               | 公司            |                         |                                              |
|               | 爱好            | 旅行 拳击               |                                              |
|               | 美食偏好        | 烧烤 西餐 川菜          | 标签                                         |
|               | 聚餐页个人简介  | 爱美食、聊情感、品人生  |                                              |
|               | 圈子个人介绍 ？ |                         |                                              |
|               | 相册，照片评论  |                         |                                              |
|               | VO_Group        | Circle2,Party5          | 圈子2级，聚餐5级                             |
|               | 是否安装客户端  |                         |                                              |
|               | 是否在线？      |                         |                                              |
|               | VO_Party[]      |                         | 发起聚会列表                                 |
|               | VO_Party[]      |                         | 参加聚会列表                                 |
|               | 发起聚会次数    | 25次                    | 发起聚会列表.length                          |
|               | 参加聚会次数    | 10次                    | 参加聚会列表.length                          |
|               | 可创建圈子数    |                         | @TODO 通过 VO_Circle_Config 和 VO_Group 计算 |
|               | 已创建圈子数    |                         | 通过 VO_Circle.Owner? 计算                   |


| 元 | 数据库字段         | 属性             | 示例                    | 备注                                         |
|----+--------------------+------------------+-------------------------+----------------------------------------------|
| PS | user_id            | 用户编号，登录名 | keke                    | userpin 的别名，即 yukuai.site_user.userpin  |
| S  | user_nickname      | 用户昵称，显示名 | 可可                    | 如未设置，则显示 userpin                     |
|    | user_realname      | 用户真名         | 曾轶可                  | 如未设置，则显示 user_nickname               |
|    | user_realname_auth | 真名是否已认证   | 0                       | [未验证，已验证]                             |
| S  | user_mobile        | 手机号码         | 13220202020             |                                              |
|    | user_mobile_auth   | 手机是否已认证   | 0                       | [未验证，已验证]                             |
|    |                    | 头像             |                         |                                              |
| S  |                    | 性别             | 女                      |                                              |
|    |                    | 生日             | 1991年6月15日           |                                              |
|    |                    | 年龄             | 21                      | 根据生日计算                                 |
| S  |                    | 区域             | 沙坪坝                  | 实现按附近的人搜索                           |
|    |                    | 现居地           | 重庆市江北区            |                                              |
|    |                    | 常出没的地方     | 重庆>观音桥 解放碑 南坪 |                                              |
|    |                    | 职业             | 产品经理                |                                              |
|    |                    | 心情、签名？     | ^_^                     |                                              |
|    |                    | 相册             |                         | @TODO                                        |
|    |                    | 是否已登录       |                         |                                              |
|    |                    | 关注列表、数量   |                         |                                              |
|    |                    | 粉丝列表、数量   |                         |                                              |
|    |                    | 礼物列表、数量   |                         |                                              |
|    |                    | 访客列表、数量   |                         |                                              |
|    |                    | 是否已实名认证   |                         |                                              |
|    |                    | 得票             |                         | 得票=人气？                                  |
| O  |                    | 人气             |                         | 什么是人气？                                 |
| O  |                    | 最新             |                         | 什么算最新？                                 |
|    |                    | 星座             |                         |                                              |
|    |                    | 公司             |                         |                                              |
|    |                    | 爱好             | 旅行 拳击               |                                              |
|    |                    | 美食偏好         | 烧烤 西餐 川菜          | 标签                                         |
|    |                    | 聚餐页个人简介   | 爱美食、聊情感、品人生  |                                              |
|    |                    | 圈子个人介绍 ？  |                         |                                              |
|    |                    | 相册，照片评论   |                         |                                              |
|    |                    | VO_Group         | Circle2,Party5          | 圈子2级，聚餐5级                             |
|    |                    | 是否安装客户端   |                         |                                              |
|    |                    | 是否在线？       |                         |                                              |
|    |                    | VO_Party[]       |                         | 发起聚会列表                                 |
|    |                    | VO_Party[]       |                         | 参加聚会列表                                 |
|    |                    | 发起聚会次数     | 25次                    | 发起聚会列表.length                          |
|    |                    | 参加聚会次数     | 10次                    | 参加聚会列表.length                          |
|    |                    | 可创建圈子数     |                         | @TODO 通过 VO_Circle_Config 和 VO_Group 计算 |
|    |                    | 已创建圈子数     |                         | 通过 VO_Circle.Owner? 计算                   |

| @followers   | VO_Circle_User[] |      | 该用户的粉丝列表                               |
| num_follower | @followers.len() |      | 粉丝数量，即人气，关注度                       |


VO_Restaurant
-------------

| 元 | 数据库字段      | 属性       | 示例                                 | 备注 |
|----+-----------------+------------+--------------------------------------+------|
| P  | restaurant_id   | 餐厅编号   |                                      |      |
|    | restaurant_name | 餐厅名字   | 铜锣湾                               |      |
|    |                 | 主展示图片 |                                      |      |
|    |                 | 促销       | 周二半价                             |      |
|    |                 | 位置、区域 | 沙坪坝>三峡广场                      |      |
|    |                 | 详细地址   | 三峡广场煌华5楼                      |      |
|    |                 | GPS 坐标   | 106.57589614391327,29.55716361871017 |      |
|    |                 | 电话       | 023-67574875                         |      |
|    |                 | 人均       | 52                                   |      |
|    |                 | 简介       | 是XXX，有XXX，特色XXX                |      |
|    |                 | 优惠信息？ |                                      |      |
|    |                 | 标签、分类 | 西餐 粤菜                            |      |
|    |                 | 点评 @TODO |                                      |      |








# 待整理

VO_Foretaste_Report
-------------

| 搜 | 序 | 属性          |                 示例 | 备注     |
|----+----+---------------+----------------------+----------|
|    |    | VO_User       |                      | 创建者   |
|    |    | 期数          |                    4 |          |
| X  |    | 创建时间      |           2012-12-12 | 报告时间 |
| X  |    | 报告题目      | 第三期外婆桥试吃报告 |          |
|    |    | 列表页图片    |                      |          |
|    |    | VO_Restaurant |                      | 商家     |
|    |    | 页面链接      |                      |          |


VO_Appointment
-------------

| 搜 | 序 | 属性           | 示例       | 备注                                |
|----+----+----------------+------------+-------------------------------------|
|    |    | VO_User        |            |                                     |
| X  |    | VO_User.性别   | 女         |                                     |
| X  |    | 约会类型       |            | [吃饭小酌,吃烧烤,吃江湖菜,休闲咖啡] |
| X  |    | 约会时间       |            |                                     |
| X  |    | 区域           |            | [渝中区,渝北区,沙坪坝,...]          |
|    |    | 约会目的、内容 | 看电影，AA | 80个字符                            |
|    |    | 约会要求       | 纯交友     | 80个字符                            |


VO_Meals
-------------

| 搜 | 序 | 属性          | 示例              | 备注     |
|----+----+---------------+-------------------+----------|
|    |    | 照片          |                   |          |
|    |    | 名字          | 铜锣湾2人情侣套餐 |          |
|    |    | 价格          | 520               |          |
|    |    | VO_Restaurant |                   | 餐厅信息 |
|    |    | 使用说明      | 仅限VIP用户       |          |
|    |    |               |                   |          |



VO_Circle_Topic
-------------

| 搜 | 序 | 属性     | 示例             | 备注 |
|----+----+----------+------------------+------|
|    |    | 名字     | 渝中好吃狗       |      |
|    |    | VO_User  | think            | 作者 |
|    |    | 回复数量 | 4                |      |
|    |    | 发表时间 | 2012-12-12 12:00 |      |


VO_Image
-------------

| 元 | 属性    | 类型         | 示例          | 备注                             |
|----+---------+--------------+---------------+----------------------------------|
| P  | id      | 图片编号     | 1             |                                  |
|    | url     | 图片地址     | /ab/cdefg.png | 相对地址，不含 host 和上传目录。 |
| F  | user    | VO_User      | keke          | 创建者                           |
|    | created | 图片上传时间 | 2012-11-11    | 记录图片上传时间                 |

VO_Topic
-------------
@TODO

** 数据库设计

yy_image
-------------

| 元 | 数据库字段    | 属性         | 示例          | 备注                             |
|----+---------------+--------------+---------------+----------------------------------|
| P  | image_id      | 图片编号     | 1             | P = 主键                         |
|    | image_url     | 图片地址     | /ab/cdefg.png | 相对地址，不含 host 和上传目录。 |
| F  | image_user    | &yy_user     | keke          | F = 外键                         |
|    | image_created | 图片上传时间 | 2012-11-11    | 记录图片上传时间                 |


```php 示例
// 判断该用户于 $cid_圈子 的申请状态是否通过
$user.circles[$cid].audit === APP_AUDIT_PASSED
```

*** VO_User::VO_Circle_User

- 圈子用户

| 属性       | 类型        | 示例 | 备注                                           |
|------------+-------------+------+------------------------------------------------|
| id         | VO_User.id  | keke | 用户 id                                        |
| created    | VO_Date     |      | 该用户档案创建时间，即第一次使用圈子功能的时间 |
| max_circle | tinyint     |    3 | 最多可创建的圈子数量                           |
| num_circle | tinyint     |    2 | 已创建的圈子数量                               |
| circles    | VO_Circle[] |      | 所有关系的圈子，包括创建的，申请的             |


*** VO_Circle

- 圈子信息

| 元 | G | G1 | 属性         | 类型                  | 示例                     | 备注                                               |
|----+---+----+--------------+-----------------------+--------------------------+----------------------------------------------------|
| P  |   |    | id           | 圈子编号              |                          | P = 主键                                           |
|    |   |    | creator      | VO_User               |                          | 创建者，从公司推广运营人员中找                     |
|    | X | X  |              | VO_User.user_nickname |                          |                                                    |
| S  | X |    | created      | 圈子创建时间          | 2012-11-11               |                                                    |
| S  | X | X  | name         | 圈子名字              | 渝中好吃狗               |                                                    |
| F  |   | X  | image        | VO_Image              |                          | 圈子主题图片 &调用相册                             |
|    |   | X  | area         | VO_Tag                | 解放碑、小什字、临江门   | 圈子活动范围                                       |
|    |   | X  | introduce    | 圈子介绍              |                          | 200个字符                                          |
|    |   | X  | notice       | 入圈须知、注意事项    | 相遇、相识、相知、相助！ | 200个字符                                          |
|    |   |    | @topics      | VO_Circle_Topic[]     |                          | 圈中话题列表 @TODO                                 |
|    | X |    | @num_topics  | @circle_topics.len()  |                          | number of topic, 圈中话题数量                      |
|    |   |    | @members     | VO_Circle_Member[]    |                          | 圈中成员（好友）列表                               |
|    | X |    | @num_members | @circle_members.len() |                          | number of members, 圈中成员数量                    |
|    |   |    | @num_girls   |                       |                          | number of girls, 圈中美女人数                      |
|    |   |    | @parties     | VO_Party[]            |                          | 圈中聚会列表                                       |
|    | X |    | @num_parties | @circle_parties.len() |                          | number of parties, 圈中聚会数量                    |
|    |   |    | observer     | VO_User               |                          | 观察者，当设置为一个用户时，可调用以下关系属性     |
|    |   |    | @audit       | 申请状态              |                          | [未申请,已申请,已拒绝]，为观察者于此圈子的申请状态 |


** 数据库设计

*** yy_circle_user

- 记录 圈子会员档案

| 元 | 数据库字段    | 类型     | 注释                         |
|----+---------------+----------+------------------------------|
| P  | user_id       | &yy_user |                              |
|    | cu_created    | int(10)  | 第一次使用圈子模块功能的时间 |
|    | cu_max_circle | tinyint  | 最多可创建的圈子数量         |
|    | cu_num_circle | tinyint  | 已创建的圈子数量             |


*** yy_circle

- 记录 圈子 信息
- 圈子的创建者是否能退出圈子？
  关涛：现在不能，以后他可以把圈主给其他人后可以。

| 元 | 数据库字段         | 类型         |          |
|----+--------------------+--------------+----------|
| P  | circle_id          | int          | 编号     |
| F  | circle_creator     | &yy_user    | 创建者   |
| F  | circle_logo        | &yy_image   | 主题图   |
|    | circle_created     | int(10)      | 创建时间 |
|    | circle_name        | varchar(64)  | 名称     |
|    | circle_introduce   | varchar(128) | 简介     |
|    | circle_notice      | varchar(128) | 注意事项 |
|    | circle_delete_flag | tinyint      | 伪删除位 |


*** yy_circle_tag

- 记录 圈子 标签，如区域

| 元 | 数据库字段 | 类型       | 注释             |
|----+------------+------------+------------------|
| F  | circle_id  | &yy_circle | 编号             |
| F  | tag_id     | &yy_tag    | 区域标签如解放碑 |


*** yy_circle_member

- 记录 圈子里的成员

| 元 | 数据库字段 | 类型        | 注释                                 |
|----+------------+-------------+--------------------------------------|
| P  | user_id    | varchar(64) |                                      |
| P  | circle_id  | int         |                                      |
| O  | cm_audited | int(10)     | 审核时间。用此字段排序，便于后台操作 |
|    | cm_audit   | tinyint     | [未审核，已通过，已拒绝]             |


*** yy_circle_party

- 记录 圈子里的聚会

| 元 | 数据库字段 | 类型       | 注释 |
|----+------------+------------+------|
| P  | party_id   | &yy_party  |      |
| P  | circle_id  | &yy_circle |      |


** yy_circle_log

- 记录 某年某时 xxx 退出了圈子 yyy，退出原因为 zzz。
- 记录 某年某时 xxx 申请加入圈子 yyy。

| 元 | 数据库字段 | 类型         | 注释                           |
|----+------------+--------------+--------------------------------|
| P  | cl_id      | int          | 编号                           |
|    | cl_date    | int(10)      | 记录发生时间                   |
| F  | user_id    | &yy_user     | xxx                            |
| F  | circle_id  | &yy_circle   | yyy                            |
|    | cl_note    | varchar(128) | zzz 备注：退出原因，加入原因等 |

*** yy_circle_topic

@TODO

*** VO_User::VO_Talent_User

| 元 | H | 属性         | 类型                 |       示例 | 备注                                          |
|----+---+--------------+----------------------+------------+-----------------------------------------------|
|    |   | parent       | VO_User              |            | 继承用户属性、及关注等功能                    |
|    | X |              | VO_User.nickname     |       可可 | 昵称                                          |
|    | X |              | VO_User.realname     |     曾轶可 | 真实姓名                                      |
|    |   |              | VO_User.mobile       |            |                                               |
|    |   |              | VO_User.num_follower |            | 关注度，粉丝数量                              |
|    |   |              |                      |            | 居住地                                        |
|    |   | created      |                      |            | 该用户档案创建时间，即第一次报名餐花秀的时间  |
|    |   | @num_flower  |                      |        345 | 朵。收到花的总数量                            |
|    |   | @nof_week    | int                  |         64 | nof = number of flower.计算本周收到的花的数量 |
|    |   | @nof_month   | int                  |        128 | 计算本月收到的花的数量                        |
|    |   | @nof_quarter | int                  |        256 | 计算本季度收到的花的数量                      |
|    |   |              | VO_Restaurant        | 小天鹅酒店 | 所在餐厅。                                    |
|    |   |              |                      |            | 职位。餐花秀专用字段                          |
|    |   |              |                      |            | 梦想。餐花秀专用字段                          |


*** VO_Talent_Champion

| 搜 | 序     | 属性          | 示例         | 备注             |
|----+--------+---------------+--------------+------------------|
|    |        | VO_Talent     |              | 餐花             |
|    | season | 期数          | 2012年12月   | 本月，2012年11月 |
|    |        | VO_Restaurant |    | 所在酒店         |
|    |        | 本期奖品      | 三星手机一部 |                  |
|    |        | 二等奖        |              |                  |
|    |        | 三等奖        |              |                  |


*** VO_Award

| 搜 | 序 | 属性     | 示例     | 备注     |
|----+----+----------+----------+----------|
|    |    | 奖品名字 | 三星手机 |          |
|    |    | @相册    |          | 奖品图片 |

** 数据库设计

*** yy_talent_user

- 记录 餐花秀会员档案

| 元 | 数据库字段    | 类型     | 注释                           |
|----+---------------+----------+--------------------------------|
| P  | user_id       | &yy_user | userpin                        |
|    | tu_created    | int(10)  | 第一次使用餐花秀模块功能的时间 |
|    | cu_num_circle | tinyint  | 已创建的圈子数量               |


*** yy_talent_user

- 记录 餐花秀会员档案

| 元 | 数据库字段    | 类型     | 注释                           |
|----+---------------+----------+--------------------------------|
| P  | user_id       | &yy_user | userpin                        |
|    | tu_created    | int(10)  | 第一次使用餐花秀模块功能的时间 |
|    | cu_n um_circle | tinyint  | 已创建的圈子数量               |
