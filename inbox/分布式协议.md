在分布式系统领域有个著名的CAP定理：

1. C-数据一致性；
2. A-服务可用性；
3. P-服务对网络分区故障的容错性

这三个特性在任何分布式系统中不能同时满足，最多同时满足两个。





Paxos（CP）
------

Paxos的目的是让整个集群的结点对某个值的变更达成一致。Paxos算法是一种基于消息传递的一致性算法。Paxos算法基本上来说是个民主选举的算法——大多数的决定会成个整个集群的统一决定。

任何一个点都可以提出要修改某个数据的提案，是否通过这个提案取决于这个集群中是否有超过半数的结点同意（所以Paxos算法需要集群中的结点是单数）。这个是Paxos相对于2PC和3PC最大的区别，在2f+1个节点的集群中，允许有f个节点不可用。

Paxos的分布式民主选举方式，除了保证数据变更的一致性之外，还常用于单点切换，比如Master选举。

缺点：Paxos 是 CP，CP系统在极端情况不能保证可用性，因为选举需要时间。所以不太适合用于服务注册。



Gossip协议（AP）
------
Gossip用于P2P系统中自治节点获悉对集群认识（如集群的节点状态，负载情况等）。

系统中的节点定期互相八卦，很快八卦就在整个系统传开了。 A、B两个节点八卦的方式主要是：A告诉B知道哪些人的什么八卦；B告诉A这些八卦里B知道哪些更新了；B更新A告诉他的八卦。

gossip 协议需要在起始阶段人工指定“种子节点”来获取初步的信息，并且一般来说需要每个节点填相同的若干个种子节点以保证在初期肯定能连到同一个集群中，此外每个gossip周期随机选其他节点同步消息时，如果随机到的不是种子节点则额外选随机一个种子节点再进行同步。这样既可以保证每个节点都能连到同一个集群中，也可以保证每个已存在的节点可以第一时间知道有新的节点加入（因为种子节点是最先知道新节点加入的）。此外gossip同步时拿到的集群节点列表是只增不减的，除非用户手动删除否则哪怕访问不到也只是标记成“无响应”，不会踢出。先保证初期能连到同一个集群中，再保证后来不会有节点退出这个集群，从而防止P2P的集群分裂。

缺点：Gossip 是 AP，AP系统在极端情况不能保证一致性。



Only Consul server nodes participate in Raft and are part of the peer set. 